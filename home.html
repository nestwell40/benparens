<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ben Parens</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="site-wrapper">
    <!-- Left Sidebar -->
    <aside class="sidebar-left">
      <a href="home.html" class="logo">Ben Parens</a>

      <div class="sidebar-left-bottom">
        <nav class="page-links">
          <a href="about.html">About</a>
          <a href="writing.html">Thoughts</a>
          <a href="outside.html">Outside</a>
        </nav>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <section class="hero-section">
        <h1 class="headline">Hello!<br>I'm Ben.</h1>

        <p class="subheadline">
          <strong>A builder and writer</strong> â€” focused on creating things that help people feel better. I write about ideas that matter to me, build the things I wish I had, and document life outside.
        </p>

        <div class="intro-text">
          <p class="section-label">Latest Publications</p>
          <div id="home-articles" class="publications-grid">
            <div class="loading">Loading posts...</div>
          </div>
        </div>
      </section>
    </main>

    <!-- Right Sidebar -->
    <aside class="sidebar-right">
      <div class="social-links-right">
        <a href="https://www.linkedin.com/in/ben-parens-411419107/" target="_blank">LinkedIn</a>
        <a href="https://benparens.substack.com" target="_blank">Substack</a>
      </div>

      <div class="sidebar-right-bottom">
        <a href="https://benparens.substack.com" target="_blank">benparens.substack.com</a>
      </div>
    </aside>
  </div>

  <!-- Mobile Nav -->
  <div class="mobile-nav" id="mobileNav">
    <button class="mobile-nav-close" onclick="document.getElementById('mobileNav').classList.remove('active')">&times;</button>
    <a href="home.html">Home</a>
    <a href="about.html">About</a>
    <a href="writing.html">Thoughts</a>
    <a href="outside.html">Outside</a>
  </div>

  <script>
    // Mobile nav toggle
    const navToggle = document.querySelector('.nav-toggle');
    if (navToggle) {
      navToggle.addEventListener('click', () => {
        document.getElementById('mobileNav').classList.add('active');
      });
    }

    // Fetch Substack posts for home page
    (function() {
      const SUBSTACK_URL = 'https://benparens.substack.com/feed';
      const CORS_PROXY = 'https://api.allorigins.win/raw?url=';
      const container = document.getElementById('home-articles');

      async function loadPosts() {
        try {
          const response = await fetch(CORS_PROXY + encodeURIComponent(SUBSTACK_URL));
          if (!response.ok) throw new Error('Fetch failed');

          const xmlText = await response.text();
          const parser = new DOMParser();
          const xml = parser.parseFromString(xmlText, 'text/xml');
          const items = xml.querySelectorAll('item');

          const posts = Array.from(items).slice(0, 4).map(item => {
            const title = item.querySelector('title')?.textContent || '';
            const link = item.querySelector('link')?.textContent || '';
            const pubDate = item.querySelector('pubDate')?.textContent || '';

            const date = new Date(pubDate);
            const formattedDate = date.toLocaleDateString('en-US', {
              year: 'numeric',
              month: 'short',
              day: 'numeric'
            });

            return { title, link, date: formattedDate };
          });

          if (posts.length === 0) {
            container.innerHTML = '<p style="color: var(--gray-500);">No posts yet.</p>';
            return;
          }

          container.innerHTML = posts.map(post => `
            <a href="${post.link}" target="_blank" class="publication-card">
              <span class="pub-date">${post.date}</span>
              <h3>${post.title}</h3>
            </a>
          `).join('');

        } catch (error) {
          container.innerHTML = `
            <p style="color: var(--gray-500);">
              Visit <a href="https://benparens.substack.com" target="_blank" style="text-decoration: underline;">my Substack</a> for latest posts.
            </p>
          `;
        }
      }

      loadPosts();
    })();
  </script>
</body>
</html>
